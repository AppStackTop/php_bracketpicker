The math section was pulled from a great gist on turning strings into math expressions by ircmaxwell at https://gist.github.com/ircmaxell/1232629
